---
jupyter:
  jupytext:
    formats: ipynb,md
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.2'
      jupytext_version: 1.5.1
  kernelspec:
    display_name: collatz
    language: python
    name: collatz
---

<!-- #region pycharm={"name": "#%% md\n"} -->
# Collatz binary theorems

This notebook validates several theorems on the binary representation of Collatz numbers.
<!-- #endregion -->

## Meta data

```python pycharm={"name": "#%%\n"}
"""
This notebook validates several theorems on the binary representation
of Collatz numbers. It builds on a sample of sequences, stored in the csv file:
data/alpha_sequences.csv. The file can be generated by executing the script
run_alpha_export.py.
"""

# Imports
from pathlib import Path
from math import ceil
from math import log2
import matplotlib.pyplot as plt
import pandas as pd
import nbutils

# Configuration
DATA_PATH = Path.cwd().parent.as_posix() + "/data/"
CSV_PATH = DATA_PATH + "alpha_export.csv"

nbutils.set_default_pd_options()

# Load data from csv
analysis_frame = pd.read_csv(
    CSV_PATH, dtype={
        "v_i": object, "kv_i+1": object, "v_i+" : object,
        "v_1_bin" : str, "v_i_bin" : str})

sequence_count = int(analysis_frame["sequence_id"].nunique())

print("Collatz sequences loaded from file:", sequence_count, "\n")
print("Count of Collatz values:", len(analysis_frame), "\n")
print("Max sequence length:", analysis_frame["sequence_len"].max(), "\n")
print("Min sequence length:", analysis_frame["sequence_len"].min())
```

## Analysis of $\Lambda_i$

```python pycharm={"name": "#%%\n"}
l_i_max = analysis_frame["l_i"].max()
l_i_min = analysis_frame["l_i"].min()

min_value_valid = (analysis_frame["l_i"] < analysis_frame["l_i_min"]).sum() == 0
max_value_valid = (analysis_frame["l_i"] > analysis_frame["l_i_max"]).sum() == 0

print("Min:", l_i_min)
print("Max:", l_i_max)
print("Boundaries valid:", min_value_valid and max_value_valid)

# Plot distribution
bins = ceil(l_i_max - l_i_min)

plt.figure()
plt.title("Distribution of l_i")
plt.hist(analysis_frame["l_i"], bins = bins)
plt.show()
```

## Analysis of $\Lambda$

```python pycharm={"name": "#%%\n"}
analysis_frame["v_1_log2"] = analysis_frame["v_1"].apply(log2)

alpha_valid = \
    (analysis_frame["a_max"] > analysis_frame["v_1_log2"].astype('int64') +
     analysis_frame["l_max"]).sum() == 0

l_max = (analysis_frame["l"]).max()
l_min = (analysis_frame["l"]).min()

min_value_valid = (analysis_frame["l"] < analysis_frame["l_min"]).sum() == 0
l_max_value_valid = (analysis_frame["l"] > analysis_frame["l_max"]).sum() == 0

print("Min:", l_min)
print("Max:", l_max)
print("Boundaries valid:", l_max_value_valid)
print("Alpha valid:", alpha_valid)

# Plot distribution
bins = ceil(l_max - l_min)

plt.figure()
plt.title("Distribution of lambda")
plt.hist(analysis_frame["l"], bins = bins)
plt.show()
```

## Analysis of $\Omega_i$

```python pycharm={"name": "#%%\n"}
o_i_max = analysis_frame["o_i"].max()
o_i_min = analysis_frame["o_i"].min()

max_value_valid = (analysis_frame["o_i"] > analysis_frame["o_i_max"]).sum() == 0

print("Min:", o_i_min)
print("Max:", o_i_max)
print("Maximum valid:", max_value_valid)

# Plot distribution
bins = ceil(o_i_max - o_i_min)

plt.figure()
plt.title("Distribution of o_i")
plt.hist(analysis_frame["o_i"], bins = bins)
plt.show()
```

## Analysis of $\Omega$

```python pycharm={"name": "#%%\n"}
o_max = analysis_frame["o"].max()
o_min = analysis_frame["o"].min()

max_value_valid = (analysis_frame["o"] > analysis_frame["o_max"]).sum() == 0

print("Min:", o_min)
print("Max:", o_max)
print("Maximum valid:", max_value_valid)

# Plot distribution
bins = ceil(o_max - o_min)

plt.figure()
plt.title("Distribution of omega")
plt.hist(analysis_frame["o"], bins = bins)
plt.show()
```
